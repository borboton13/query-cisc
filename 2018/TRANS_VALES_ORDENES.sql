SELECT *
FROM EOS.ORDENPRODUCCION

SELECT *
FROM EOS.PLANIFICACIONPRODUCCION

SELECT O.NO_VALE
FROM EOS.ORDENPRODUCCION O, EOS.PLANIFICACIONPRODUCCION P
WHERE O.IDPLANIFICACIONPRODUCCION = P.IDPLANIFICACIONPRODUCCION 
AND P.FECHA BETWEEN TO_DATE('01/01/2014','DD/MM/YYYY') AND TO_DATE('31/01/2014','DD/MM/YYYY') 

SELECT * 
FROM WISE.INV_VALES V
WHERE V.NO_VALE = '5-6' -- NO_TRANS: 44840

-- PARA BORRAR VALES RELACIONADAS A ORDENES DE PRODUCCION
-- PASO 1.- BUSCAR NO_TRANS DE LOS VALES
SELECT V.NO_TRANS, V.NO_VALE
FROM WISE.INV_VALES V
WHERE V.NO_VALE IN (
    SELECT O.NO_VALE
    FROM EOS.ORDENPRODUCCION O, EOS.PLANIFICACIONPRODUCCION P
    WHERE O.IDPLANIFICACIONPRODUCCION = P.IDPLANIFICACIONPRODUCCION 
    AND P.FECHA BETWEEN TO_DATE('01/01/2014','DD/MM/YYYY') AND TO_DATE('31/01/2014','DD/MM/YYYY') 
);


-- ELIMINAR INV_MOVDET
-- SELECT * FROM WISE.INV_MOVDET
DELETE FROM WISE.INV_MOVDET
WHERE COD_ALM = 2
AND ESTADO = 'APR'
AND NO_TRANS IN (
        SELECT V.NO_TRANS
        FROM WISE.INV_VALES V
        WHERE V.NO_VALE IN (
            SELECT O.NO_VALE
            FROM EOS.ORDENPRODUCCION O, EOS.PLANIFICACIONPRODUCCION P
            WHERE O.IDPLANIFICACIONPRODUCCION = P.IDPLANIFICACIONPRODUCCION 
            AND P.FECHA BETWEEN TO_DATE('01/01/2014','DD/MM/YYYY') AND TO_DATE('31/01/2014','DD/MM/YYYY') 
        )
)

-- PASO 2.- BORRAR WISE.INV_MOV
-- DELETE FROM WISE.INV_MOV
WHERE DESCRI LIKE '%ORDEN DE PRODUCCION%'
AND NO_TRANS IN (
            SELECT V.NO_TRANS
            FROM WISE.INV_VALES V
            WHERE V.NO_VALE IN (
                SELECT O.NO_VALE
                FROM EOS.ORDENPRODUCCION O, EOS.PLANIFICACIONPRODUCCION P
                WHERE O.IDPLANIFICACIONPRODUCCION = P.IDPLANIFICACIONPRODUCCION 
                AND P.FECHA BETWEEN TO_DATE('01/01/2014','DD/MM/YYYY') AND TO_DATE('31/01/2014','DD/MM/YYYY') 
            )
)

-- PASO 3.- BORRAR WISE.INV_VALES
DELETE FROM WISE.INV_VALES
WHERE COD_ALM = 2
AND ESTADO = 'APR'
AND NO_TRANS IN (
                SELECT V.NO_TRANS
                FROM WISE.INV_VALES V
                WHERE V.NO_VALE IN (
                    SELECT O.NO_VALE
                    FROM EOS.ORDENPRODUCCION O, EOS.PLANIFICACIONPRODUCCION P
                    WHERE O.IDPLANIFICACIONPRODUCCION = P.IDPLANIFICACIONPRODUCCION 
                    AND P.FECHA BETWEEN TO_DATE('01/01/2014','DD/MM/YYYY') AND TO_DATE('31/01/2014','DD/MM/YYYY') 
                    )
                )


-- PASO 4.- ACTUALIZAR INVENTARIOS
-- ACTUALIZAR SALDO UNITARIO => SALDO_UNI (Total unidades)
-- UPDATE WISE.INV_INVENTARIO I 
SET I.SALDO_UNI = 0
WHERE I.COD_ART IN (100,101,103,107,108,109,110,111,112,114,115,116,120,123,124,125,126,129,132,134,135,136,152,94,95)


-- PASO 5.- CANTIDAD (SALDO UNIDADES) ******************************************
SELECT *
-- COD_ALM, COD_ART, CANTIDAD (SALDO UNIDADES)
FROM WISE.INV_INVENTARIO_DETALLE        -- CANTDAD
-- UPDATE WISE.INV_INVENTARIO_DETALLE SET CANTIDAD = 0
WHERE COD_ALM = 2
AND COD_ART IN (100,101,103,107,108,109,110,111,112,114,115,116,120,123,124,125,126,129,132,134,135,136,152,94,95)

-- PASO 6.- COSTO_UNI,     SALDO_MON =  costo unitario * cantidad 
SELECT COD_ART,DESCRI,COSTO_UNI,SALDO_MON 
FROM WISE.INV_ARTICULOS     
-- UPDATE WISE.INV_ARTICULOS SET COSTO_UNI=0, SALDO_MON=0 
WHERE COD_ART IN (100,101,103,107,108,109,110,111,112,114,115,116,120,123,124,125,126,129,132,134,135,136,152,94,95)

-- PASO 7.- UNIDADES ENTRANTES O SALIENTES dependiendo del tipo de vale
SELECT * 
FROM WISE.INV_INVMES            
-- UPDATE WISE.INV_INVMES SET UNIDAD_ENT =0, UNIDAD_SAL=0, MONTO_ENT=0,MONTO_SAL=0
WHERE COD_ALM = 2
AND  COD_ART IN (100,101,103,107,108,109,110,111,112,114,115,116,120,123,124,125,126,129,132,134,135,136,152,94,95)


-- AUX
SELECT AR.COD_ART, AR.DESCRI, ID.SALDO_UNI, AR.COSTO_UNI, AR.SALDO_MON
FROM WISE.INV_INVENTARIO ID, WISE.INV_ARTICULOS AR
WHERE ID.COD_ART = AR.COD_ART  
AND ID.COD_ART IN (100,101,103,107,108,109,110,111,112,114,115,116,120,123,124,125,126,129,132,134,135,136,152,94,95)

